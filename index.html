<!DOCTYPE html>
<html>
<head>
    <title>👑 Owner Panel - FIXED!</title>
    <style>
        body { font-family: Arial; max-width: 400px; margin: 50px auto; padding: 20px; }
        button { width: 100%; padding: 15px; margin: 10px 0; font-size: 16px; }
        .purple { background: #6f42c1; color: white; border: none; }
        .orange { background: #fd7e14; color: white; border: none; }
        input { width: 100%; padding: 12px; margin: 10px 0; font-size: 16px; }
        #status { color: red; font-weight: bold; padding: 10px; }
        #info { color: green; padding: 10px; }
        #test { color: blue; }
    </style>
    
    <!-- ✅ WORKING CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
</head>
<body>
    <h1>👑 Owner Panel</h1>
    
    <div id="test">Checking Ethers... </div>
    
    <button id="connect" class="purple">🔗 Connect 2 Owner</button>
    <div id="wallet"></div>
    <div id="info">Price: Loading...</div>
    
    <input id="sendamt" type="number" placeholder="AsiaX Send (1000)">
    <button id="send" class="orange" disabled>📤 Send AsiaX</button>
    
    <input id="price" type="number" placeholder="Price (2)">
    <button id="setprice" class="orange" disabled>💰 Set Price</button>
    
    <input id="receiver" type="text" placeholder="Receiver Address">
    <button id="setrec" class="orange" disabled>🏦 Set Receiver</button>
    
    <div id="status"></div>

    <script>
        // ✅ TEST ETHER FIRST
        if (typeof ethers === 'undefined') {
            document.getElementById('test').innerHTML = '❌ Ethers NOT LOADED!';
            throw new Error('Ethers not loaded');
        }
        document.getElementById('test').innerHTML = '✅ Ethers LOADED!';
        
        // 🚨 ADDRESSES BADALO!
        const CONTRACT_ADDR = '0xCA275a92B4845f3caD2995FaeC00733849C4e6D1';
        const ASIAX_ADDR = '0xe36b5223d488322fac2ddda937e5ab226e83fbbd';

        const abi = [
            "function setPrice(uint256) external",
            "function setReceiver(address) external",
            "function getHumanPrice() view returns(uint256)",
            "function owner() view returns(address)"
        ];
        const erc20 = ["function transfer(address,uint256)", "function decimals() view returns(uint8)"];

        let wallet, contract, token;

        document.getElementById('connect').onclick = async () => {
            if (window.ethereum) {
                try {
                    await window.ethereum.enable();
                    const provider = new ethers.providers.Web3Provider(window.ethereum);
                    const signer = provider.getSigner();
                    wallet = await signer.getAddress();
                    
                    contract = new ethers.Contract(CONTRACT_ADDR, abi, signer);
                    token = new ethers.Contract(ASIAX_ADDR, erc20, signer);
                    
                    const owner = await contract.owner();
                    if (wallet.toLowerCase() != owner.toLowerCase()) {
                        alert('❌ OWNER WALLET NAHI!');
                        return;
                    }
                    
                    document.getElementById('wallet').innerHTML = 
                        '✅ Owner: ' + wallet.substring(0,6) + '...' + wallet.substring(38);
                    
                    loadPrice();
                    document.querySelectorAll('button[disabled]').forEach(b => b.disabled = false);
                    
                } catch(e) {
                    document.getElementById('status').innerHTML = '❌ ' + e.message;
                }
            } else {
                alert('MetaMask install karo!');
            }
        };

        async function loadPrice() {
            try {
                const price = await contract.getHumanPrice();
                document.getElementById('info').innerHTML = '💰 1 USDT = ' + price + ' AsiaX';
            } catch(e) {
                document.getElementById('info').innerHTML = '❌ Price nahi set';
            }
        }
document.getElementById('send').onclick = async () => {
            document.getElementById('status').innerHTML = '⏳ Sending...';
            try {
                const amt = document.getElementById('sendamt').value;
                const dec = await token.decimals();
                const units = ethers.utils.parseUnits(amt, dec);
                const tx = await token.transfer(CONTRACT_ADDR, units);
                await tx.wait();
                document.getElementById('status').innerHTML = '✅ Sent!';
            } catch(e) {
                document.getElementById('status').innerHTML = '❌ ' + e.message;
            }
        };

        document.getElementById('setprice').onclick = async () => {
            document.getElementById('status').innerHTML = '⏳ Setting price...';
            try {
                const price = document.getElementById('price').value;
                const tx = await contract.setPrice(price);
                await tx.wait();
                document.getElementById('status').innerHTML = '✅ Price Set!';
                loadPrice();
            } catch(e) {
                document.getElementById('status').innerHTML = '❌ ' + e.message;
            }
        };

        document.getElementById('setrec').onclick = async () => {
            document.getElementById('status').innerHTML = '⏳ Setting receiver...';
            try {
                const addr = document.getElementById('receiver').value;
                const tx = await contract.setReceiver(addr);
                await tx.wait();
                document.getElementById('status').innerHTML = '✅ Receiver Set!';
            } catch(e) {
                document.getElementById('status').innerHTML = '❌ ' + e.message;
            }
        };
    </script>
</body>
</html>
