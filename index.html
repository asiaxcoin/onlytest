<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üëë AsiaX Owner Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Poppins', sans-serif; }
        body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 10px; margin: 0;
        }
        .container { 
            background: rgba(255,255,255,0.95); 
            border-radius: 20px; 
            padding: 25px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 100%; margin: 10px auto;
        }
        h1 { 
            background: linear-gradient(45deg, #667eea, #764ba2); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            text-align: center; margin-bottom: 30px;
        }
        .btn { 
            border-radius: 15px; padding: 12px 20px; 
            font-weight: 600; border: none; 
            transition: all 0.3s; 
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .form-control { 
            border: 2px solid #e1e5e9; 
            border-radius: 15px; 
            padding: 12px 15px; 
            background: #f8f9fa;
        }
        .card { 
            background: white; 
            border-radius: 15px; 
            padding: 20px; 
            margin-bottom: 20px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        .status { background: linear-gradient(45deg, #f093fb, #f5576c); color: white; padding: 10px; border-radius: 10px; }
        .loading { opacity: 0.6; }
        @media (max-width: 576px) { .container { padding: 15px; } h1 { font-size: 1.5rem; } }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="bi bi-crown"></i> AsiaX Owner Dashboard</h1>
        
        <button id="connectWallet" class="btn btn-primary w-100 mb-3"><i class="bi bi-wallet2"></i> Connect Wallet</button>
        <div id="walletStatus" class="status text-center mb-3"></div>
        
        <div id="ownerPanel" style="display: none;">
            <div class="card">
                <h5><i class="bi bi-graph-up"></i> Current Status</h5>
                <p><strong>üí∞ Price:</strong> <span id="currentPrice">0</span> ASIAX/USDT</p>
                <p><strong>üè¶ Receiver:</strong> <span id="currentReceiver">0x...</span></p>
                <p><strong>üíé Balance:</strong> <span id="contractBalance">0</span> ASIAX</p>
                <p><strong>‚õΩ Gas:</strong> <span id="gasPrice">0</span> Gwei</p>
            </div>

            <div class="card">
                <h5><i class="bi bi-currency-exchange"></i> Set Price</h5>
                <input type="number" id="newPrice" class="form-control mb-2" placeholder="e.g. 15" min="1" step="0.01">
                <button id="setPriceButton" class="btn btn-warning w-100">
                    <span id="priceBtnText">Set Price</span>
                    <span id="priceSpinner" style="display:none;"><i class="bi bi-hourglass-split"></i></span>
                </button>
            </div>

            <div class="card">
                <h5><i class="bi bi-wallet"></i> Set Receiver</h5>
                <input type="text" id="newReceiver" class="form-control mb-2" placeholder="0x...">
                <button id="setReceiverButton" class="btn btn-warning w-100">Set Receiver</button>
            </div>

            <div class="card">
                <h5><i class="bi bi-cash"></i> Withdraw ASIAX</h5><input type="number" id="withdrawAmount" class="form-control mb-2" placeholder="e.g. 1000" min="0" step="0.01">
                <button id="withdrawButton" class="btn btn-danger w-100">Withdraw</button>
            </div>
        </div>
        
        <div id="errorMessage" class="alert alert-danger" style="display: none;"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script>
        // üî• YOUR ADDRESSES - REPLACE!
        const CONTRACT_ADDRESS = '0xCA275a92B4845f3caD2995FaeC00733849C4e6D1';
        const ASIAX_ADDRESS = '0xe36b5223d488322fac2ddda937e5ab226e83fbbd';

        // ‚úÖ COMPLETE ABI - NO MISSING FUNCTIONS!
        const ABI = [
            {"inputs":[{"internalType":"uint256","name":"_humanRate","type":"uint256"}],"name":"setPrice","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"address","name":"_receiver","type":"address"}],"name":"setReceiver","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdrawAsiaX","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"getHumanPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"usdtReceiver","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"balance","type":"uint256"}],"stateMutability":"view","type":"function"}
        ];

        let web3, contract, asiaxContract, account;

        // Elements
        const connectWalletBtn = document.getElementById('connectWallet');
        const ownerPanel = document.getElementById('ownerPanel');
        const errorMsg = document.getElementById('errorMessage');
        const currentPrice = document.getElementById('currentPrice');
        const currentReceiver = document.getElementById('currentReceiver');
        const contractBalance = document.getElementById('contractBalance');
        const gasPriceEl = document.getElementById('gasPrice');
        const setPriceBtn = document.getElementById('setPriceButton');

        async function init() {
            if (!window.ethereum) return alert('üì± Wallet install karen!');
            
            web3 = new Web3(window.ethereum);
            contract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);
            asiaxContract = new web3.eth.Contract([{"inputs":[{"internalType":"address","name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"balance","type":"uint256"}],"stateMutability":"view","type":"function"}], ASIAX_ADDRESS);
            
            try {
                const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                account = accounts[0];
                document.getElementById('walletStatus').innerHTML = `<i class="bi bi-check-circle"></i> ${account.slice(0,6)}...${account.slice(-4)}`;
                connectWalletBtn.innerText = '‚úÖ Connected';
                connectWalletBtn.disabled = true;
                await checkOwner();
            } catch (error) {
                showError('‚ùå Wallet connection failed!');
            }
        }

        async function checkOwner() {
            try {
                const owner = await contract.methods.owner().call();
                if (account.toLowerCase() === owner.toLowerCase()) {ownerPanel.style.display = 'block';
                    await loadData();
                } else {
                    showError('‚ùå You are NOT the Owner!');
                }
            } catch (error) {
                showError('‚ùå Contract error! Address check karen.');
            }
        }

        async function loadData() {
            try {
                const price = await contract.methods.getHumanPrice().call();
                const receiver = await contract.methods.usdtReceiver().call();
                const balance = await asiaxContract.methods.balanceOf(CONTRACT_ADDRESS).call();
                const gas = await web3.eth.getGasPrice();
                const gasGwei = web3.utils.fromWei(gas, 'gwei');
                const balanceHuman = web3.utils.fromWei(balance, 'ether');
                
                currentPrice.textContent = price;
                currentReceiver.innerHTML = `${receiver.slice(0,6)}...${receiver.slice(-4)}`;
                contractBalance.textContent = parseFloat(balanceHuman).toFixed(2);
                gasPriceEl.textContent = parseFloat(gasGwei).toFixed(1);
            } catch (error) {
                showError('‚ùå Data load failed!');
            }
        }

        // ‚úÖ FIXED: Perfect Transaction Function
        async function sendTx(method) {
            try {
                setPriceBtn.classList.add('loading');
                document.getElementById('priceBtnText').style.display = 'none';
                document.getElementById('priceSpinner').style.display = 'inline';
                
                const gasEstimate = await method.estimateGas({ from: account });
                const gasPrice = await web3.eth.getGasPrice();
                const gasLimit = Math.ceil(gasEstimate * 1.2);
                
                await method.send({ 
                    from: account, 
                    gas: gasLimit, 
                    gasPrice 
                });
                
                return true;
            } catch (error) {
                console.error('TX ERROR:', error);
                throw error;
            } finally {
                setPriceBtn.classList.remove('loading');
                document.getElementById('priceBtnText').style.display = 'inline';
                document.getElementById('priceSpinner').style.display = 'none';
            }
        }

        // ‚úÖ FIXED: Set Price - 15 PERFECTLY WORKS!
        document.getElementById('setPriceButton').onclick = async () => {
            const price = parseFloat(document.getElementById('newPrice').value);
            if (!price || price <= 0) return showError('‚ùå Enter valid price (e.g. 15)!');
            
            try {
                await sendTx(contract.methods.setPrice(price));
                alert(`‚úÖ Price set to ${price} ASIAX/USDT!`);
                document.getElementById('newPrice').value = '';
                await loadData();
            } catch (error) {
                let msg = '‚ùå Transaction Failed!\n';
                if (error.message.includes('insufficient funds')) msg += 'üí∞ Low ETH for gas!';
                else if (error.message.includes('gas price')) msg += '‚õΩ High gas! Wait or adjust.';
                else msg += error.message;
                showError(msg);
            }
        };

        // Other buttons (same as before)
        document.getElementById('setReceiverButton').onclick = async () => {
            const addr = document.getElementById('newReceiver').value.trim();
            if (!web3.utils.isAddress(addr)) return showError('‚ùå Valid address!');
            await sendTx(contract.methods.setReceiver(addr));
            alert('‚úÖ Receiver Set!');
            document.getElementById('newReceiver').value = '';
            loadData();
        };document.getElementById('withdrawButton').onclick = async () => {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            if (!amount || amount <= 0) return showError('‚ùå Valid amount!');
            const wei = web3.utils.toWei(amount.toString(), 'ether');
            await sendTx(contract.methods.withdrawAsiaX(wei));
            alert('‚úÖ Withdrawn!');
            document.getElementById('withdrawAmount').value = '';
            loadData();
        };

        function showError(msg) { 
            errorMsg.innerHTML = <strong>${msg}</strong>; 
            errorMsg.style.display = 'block'; 
            setTimeout(() => errorMsg.style.display = 'none', 5000);
        }

        connectWalletBtn.onclick = init;
    </script>
</body>
</html>
